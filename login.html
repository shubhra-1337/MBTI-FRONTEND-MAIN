<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KnowThySelf | Login</title>

  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg-dark:#00050a;
      --highlight:#00f2ff;
      --contrast:#2979ff;
      --text-main:#ffffff;
      --text-muted:#8ba4b6;
      --glass-bg:linear-gradient(135deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
      --glass-border:rgba(255,255,255,.08);
      --glass-shine:rgba(255,255,255,.15);
    }

    * { box-sizing:border-box; margin:0; padding:0; }

    body {
      font-family:"Rajdhani",sans-serif;
      background:var(--bg-dark);
      color:var(--text-main);
      min-height:100vh;
      overflow-x:hidden;
    }

    .animated-bg {
      position:fixed; inset:0; z-index:-2;
      background:radial-gradient(circle at 50% 50%,#051525 0%,#00050a 100%);
      background-size:200% 200%;
      animation:deepPulse 15s ease infinite alternate;
    }

    @keyframes deepPulse {
      0%{background-position:0% 50%}
      100%{background-position:100% 50%}
    }

    #particleCanvas {
      position:fixed; inset:0; z-index:-1; opacity:.6;
    }

    header {
      max-width:1200px; margin:auto;
      padding:35px 20px 10px;
      display:flex; justify-content:space-between; align-items:center;
    }

    .brand {
      font-size:1.3rem; font-weight:700;
      letter-spacing:2px; text-transform:uppercase;
      color:var(--highlight);
      text-shadow:0 0 15px rgba(0,242,255,.4);
    }

    .back {
      color:var(--text-muted); text-decoration:none;
      font-weight:700; letter-spacing:2px;
      padding:10px 14px; border-radius:30px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.02);
      transition:.25s;
    }

    .back:hover {
      color:var(--highlight);
      border-color:var(--highlight);
      box-shadow:0 0 15px rgba(0,242,255,.2);
    }

    .wrap {
      max-width:1200px; margin:auto;
      padding:25px 20px 55px;
      display:grid; grid-template-columns:1fr 1fr;
      gap:25px; align-items:center;
    }

    .glass-card {
      background:var(--glass-bg);
      backdrop-filter:blur(25px);
      border:1px solid var(--glass-border);
      border-radius:22px;
      padding:28px;
      box-shadow:0 30px 60px rgba(0,0,0,.65);
      position:relative;
    }

    .glass-card::before {
      content:"";
      position:absolute; top:0; left:0;
      width:100%; height:3px;
      background:linear-gradient(90deg,transparent,var(--highlight),transparent);
      box-shadow:0 0 12px var(--highlight);
    }

    .title {
      font-size:clamp(2rem,4vw,3rem);
      font-weight:800; letter-spacing:3px;
      text-transform:uppercase;
      color:var(--highlight);
      text-shadow:0 0 22px rgba(0,242,255,.35);
    }

    .sub {
      margin-top:10px; color:#d0dbe6;
      font-size:1.15rem; line-height:1.6;
    }

    label {
      display:block; margin:12px 0 6px;
      font-weight:700; letter-spacing:1px;
      text-transform:uppercase;
      color:var(--text-muted);
    }

    input {
      width:100%; padding:13px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.35);
      color:#fff; font-size:1.05rem;
    }

    input:focus {
      border-color:var(--highlight);
      box-shadow:0 0 15px rgba(0,242,255,.25);
      outline:none;
    }

    .btn-glow {
      width:100%; margin-top:16px;
      padding:15px 18px;
      background:rgba(0,242,255,.05);
      border:1px solid var(--highlight);
      color:var(--highlight);
      font-weight:800; letter-spacing:3px;
      text-transform:uppercase;
      border-radius:12px;
      cursor:pointer;
      transition:.3s;
    }

    .btn-glow:hover {
      background:var(--highlight);
      color:#000;
      box-shadow:0 0 40px rgba(0,242,255,.55);
    }

    .msg { margin-top:12px; font-weight:700; }
    .error { color:#ff6b6b; }
    .ok { color:#7cffb2; }

    @media(max-width:900px){
      .wrap{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
<div class="animated-bg"></div>
<canvas id="particleCanvas"></canvas>

<header>
  <div class="brand">Know Thy Self</div>
  <a class="back" href="home.html">‚Üê Back Home</a>
</header>

<main class="wrap">
  <section class="glass-card">
    <div class="title">Access Portal</div>
    <p class="sub">
      Enter your details to begin the assessment.  
      Your information is used only to store visitor logs.
    </p>
  </section>

  <section class="glass-card">
    <div class="title" style="font-size:2.1rem">Login / Register</div>
    <p class="sub">Proceed to MBTI test sequence.</p>

    <form id="visitorForm">
      <label>Full Name</label>
      <input id="name" required />

      <label>Email</label>
      <input id="email" type="email" required />

      <label>Age</label>
      <input id="age" type="number" required />

      <button class="btn-glow">Continue ‚Üí</button>
      <div id="message" class="msg"></div>
    </form>
  </section>
</main>

<script>
  /* üåå PARTICLES */
  const canvas = document.getElementById("particleCanvas");
  const ctx = canvas.getContext("2d");
  let particles = [];

  function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
  addEventListener("resize",resize); resize();

  class Particle{
    constructor(){
      this.x=Math.random()*canvas.width;
      this.y=Math.random()*canvas.height;
      this.vy=Math.random()*0.5+0.3;
      this.size=Math.random()*2+1;
      this.op=Math.random()*0.5+0.2;
    }
    update(){
      this.y+=this.vy;
      this.x+=Math.sin(this.y*0.01)*0.3;
      if(this.y>canvas.height){this.y=-10;this.x=Math.random()*canvas.width;}
    }
    draw(){
      ctx.beginPath();
      ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
      ctx.fillStyle=`rgba(255,255,255,${this.op})`;
      ctx.fill();
    }
  }
  for(let i=0;i<100;i++)particles.push(new Particle());
  (function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles.forEach(p=>{p.update();p.draw()});
    requestAnimationFrame(animate);
  })();

  /* üîó BACKEND */
  const API_BASE =
    location.hostname==="localhost"||location.hostname==="127.0.0.1"
    ? "http://localhost:5000/api/visitors"
    : "https://mbti-backend-main.vercel.app/api/visitors";

  document.getElementById("visitorForm").addEventListener("submit",async e=>{
    e.preventDefault();
    const msg=document.getElementById("message");
    msg.textContent=""; msg.className="msg";

    const name=nameEl.value=nameEl?.value||document.getElementById("name").value.trim();
    const email=document.getElementById("email").value.trim();
    const age=document.getElementById("age").value.trim();

    try{
      const res=await fetch(API_BASE,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({name,email,age:Number(age),userAgent:navigator.userAgent})
      });
      if(!res.ok) throw 0;

      localStorage.setItem("mbtiUser",JSON.stringify({name,email,age:Number(age)}));
      msg.textContent="Saved ‚úÖ Redirecting...";
      msg.classList.add("ok");
      setTimeout(()=>location.href="test.html",400);
    }catch{
      msg.textContent="Backend not running / error storing data.";
      msg.classList.add("error");
    }
  });
</script>
</body>
</html>

